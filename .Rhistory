load("C:/Users/98706/Desktop/TAMs/singlecell/0.RData")
#å¼•ç”¨åŒ?library(limma)
library(clustree)
library(Seurat)
library(dplyr)
library(magrittr)
library(celldex)
library(SingleR)
library(monocle)
library(scCATCH)
showGenes=c("IRF7")
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
pdf(file="03.markerScatter.pdf",width=10,height=6)
FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
dev.off()
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
pdf(file="03.IRF7.pdf",width=10,height=6)
cluster10Marker=showGenes
DotPlot(object = pbmc, features = cluster10Marker)
dev.off()
> library(scCATCH)
> showGenes=c("RXRA")
>
> #ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
> pdf(file="03.markerScatter.pdf",width=10,height=6)
> FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
> dev.off()
null device
1
>
> #ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
> pdf(file="03.RXRA.pdf",width=10,height=6)
> cluster10Marker=showGenes
> DotPlot(object = pbmc, features = cluster10Marker)
> dev.off()
showGenes=c("RXRA")
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
pdf(file="03.markerScatter.pdf",width=10,height=6)
FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
dev.off()
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
pdf(file="03.RXRA.pdf",width=40,height=6)
cluster10Marker=showGenes
DotPlot(object = pbmc, features = cluster10Marker)
dev.off()
showGenes=c("FOSL2")
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
pdf(file="03.markerScatter.pdf",width=10,height=6)
FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
dev.off()
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
pdf(file="03.FOSL2.pdf",width=40,height=6)
cluster10Marker=showGenes
DotPlot(object = pbmc, features = cluster10Marker)
dev.off()
showGenes=c("NFIL3")
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
pdf(file="03.markerScatter.pdf",width=10,height=6)
FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
dev.off()
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
pdf(file="03.NFIL3.pdf",width=40,height=6)
cluster10Marker=showGenes
DotPlot(object = pbmc, features = cluster10Marker)
dev.off()
showGenes=c("RARA")
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ•£ç‚¹å›¾
pdf(file="03.markerScatter.pdf",width=10,height=6)
FeaturePlot(object = pbmc, features = showGenes, cols = c("blue", "red"))
dev.off()
#ç»˜åˆ¶markeråœ¨å„ä¸ªclusterçš„æ°”æ³¡å›¾
pdf(file="03.RARA.pdf",width=40,height=6)
cluster10Marker=showGenes
DotPlot(object = pbmc, features = cluster10Marker)
dev.off()
a<- c(1, 2, 3)
b<- c(4, 5, 6)
c <- a/b
c
d <- mean(c)
e <- c*d
a <- matrix(a)
m1 <- matrix(c(1:6),nrow=2,ncol=3,dimnames=list(c("r1","r2"),c("c1","c2","c3")))
m1
m1 *a
e <- m1 * m1
e
f<-rep(1:4,2)
f
load("C:/Users/98706/Desktop/singlecell/ccRCC/a.RData")
View(clusterAnn)
View(monocle.clusterAnn)
knitr::opts_chunk$set(echo = TRUE)
library(clusterProfiler)
library(GSVA)
library(pheatmap)
library(gplots)
Sys.setenv(LANGUAGE = "en") #æ˜¾ç¤ºè‹±æ–‡æŠ¥é”™ä¿¡æ¯
options(stringsAsFactors = FALSE) #ç¦æ­¢chrè½¬æˆfactor
expr <- read.csv("easy_input_expr.csv", check.names = F, row.names = 1)
expr[1:3,1:3]
dim(expr)
subt <- read.table("easy_input_subtype.txt", sep = "\t", check.names = F, stringsAsFactors = F, header = T, row.names = 1)
head(subt)
table(subt$TCGA_Subtype)
### è‡ªå®šä¹‰å‡½æ•°æ˜¾ç¤ºè¿›åº?###
display.progress = function ( index, totalN, breakN=20) {
if ( index %% ceiling(totalN/breakN)  ==0  ) {
cat(paste(round(index*100/totalN), "% ", sep=""))
}
}
n.sub <- length(table(subt$TCGA_Subtype)) # äºšå‹ä¸ªæ•°
n.sub.label <- unique(subt$TCGA_Subtype) # äºšå‹åç§°
expr <- log2(expr + 1)
treat_list <- ctrl_list <- degs.list <- list() # åˆå§‹åŒ–åˆ—è¡?for (i in 1:n.sub) {
cat(paste0(n.sub.label[i], " vs. Others starts!\n"))
treat_list[[i]] <- rownames(subt)[which(subt$TCGA_Subtype == n.sub.label[i])] # é€‰å–æŸäºšå‹ä¸ºtreatç»?ctrl_list[[i]] <- rownames(subt)[-which(subt$TCGA_Subtype == n.sub.label[i])] # é€‰å–å‰©ä½™äºšå‹ä¸ºcontrolç»?meanA <- meanB <- p <- fc <- lgfc <- c() #åˆå§‹åŒ–å‘é‡?for (k in 1:nrow(expr)) {
display.progress(index = k,totalN = nrow(expr)) #æ˜¾ç¤ºè¿›ç¨‹
a <- as.numeric(expr[k,treat_list[[i]]])
b <- as.numeric(expr[k,ctrl_list[[i]]])
p <- c(p,t.test(a,b,na.rm=T)$p.value) # æ£€éªŒè¡¨è¾¾å·®å¼?meanA <- c(meanA,mean(a)) # treatç»„åŸºå› kè¡¨è¾¾å‡å€?meanB <- c(meanB,mean(b)) # controlç»„åŸºå› kè¡¨è¾¾å‡å€?fc <- c(fc,mean(a)/mean(b)) # è®¡ç®—foldchange
lgfc <- c(lgfc,log2(mean(a)/mean(b))) # è®¡ç®—log2foldchange
}
fdr <- p.adjust(p,method = "fdr") # æ ¡æ­£på€?# ç”Ÿæˆå·®å¼‚è¡¨è¾¾ç»“æœï¼Œå…¶ä¸­log2FoldChange, pvalue, padjæ¨¡ä»¿DESeq2ç»“æœæ ¼å¼
# ç”±äºå·®å¼‚è¡¨è¾¾åˆ†æä¸æ˜¯æœ¬ä¼—ç­¹çš„ç›®çš„ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨ç®€å•çš„ä¸¤æ ·æœ¬tæ£€éªŒå¯»æ‰¾æ˜¾è‘—å·®å¼‚è¡¨è¾¾åŸºå› ã€‚å·®å¼‚è¡¨è¾¾åˆ†æå¯æ ¹æ®å®é™…æ•°æ®æƒ…å†µæ¢ç”¨limmaï¼ˆä¾‹æ–‡ï¼‰, DESeq, DESeq2, edgeRç­‰æ–¹æ³•ã€?degs <- data.frame(mean_treat=meanA,
mean_ctrl=meanB,
FoldChange=fc,
log2FoldChange=lgfc,
pvalue=p,
padj=fdr,
row.names = rownames(expr),
stringsAsFactors = F)
write.table(degs,paste0(n.sub.label[[i]],"_degs.txt"),sep = "\t",row.names = T,col.names = NA,quote = F)
degs.list[[n.sub.label[i]]] <- as.data.frame(na.omit(degs))
cat("\n")
}
subtype_specific_gsea <- function(msigdb=NULL,n.top=10,mode=c("up","down"),degs.list=NULL,subtype.label=NULL,nPerm.gsea=1000,minGSSize.gsea=10,maxGSSize.gsea=500,pvalueCutoff.gsea=1){
MSigDB <- read.gmt(msigdb)
GSEA.list <- top.gs <- list() #åˆå§‹åŒ–ç»“æœåˆ—è¡?if(!is.element(mode, c("up", "dn"))) { stop("mode must be up or dn!\n") }
for (i in 1:n.sub) {
degs <- degs.list[[n.sub.label[i]]]
geneList <- degs$log2FoldChange; names(geneList) <- rownames(degs)
geneList <- sort(geneList,decreasing = T) # ranked gene set
# ç”±äºGSEAä¸å¯é‡å¤ï¼Œæ‰€ä»¥ä¿å­˜GSEAå¯¹è±¡å…¥åˆ—è¡¨ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è°ƒç”¨
cat(paste0("GSEA for ",subtype.label[i]," starts!\n"))
GSEA.list[[subtype.label[i]]] <- GSEA(geneList = geneList,
TERM2GENE=MSigDB,
nPerm = nPerm.gsea,
minGSSize = minGSSize.gsea,
maxGSSize = maxGSSize.gsea,
seed = T,
verbose = F,
pvalueCutoff = pvalueCutoff.gsea) # è¾“å‡ºå…¨éƒ¨çš„GESAç»“æœ
GSEA.dat <- as.data.frame(GSEA.list[[subtype.label[i]]])
if(mode == "up") {
GSEA.dat <- GSEA.dat[order(GSEA.dat$NES,decreasing = T),] # æ ¹æ®NESé™åºæ’åˆ—ï¼Œä¹Ÿå°±æ˜¯æ‰¾ç‰¹å¼‚æ€§ä¸Šè°ƒé€šè·¯
} else {
GSEA.dat <- GSEA.dat[order(GSEA.dat$NES,decreasing = F),] # æ ¹æ®NESå‡åºæ’åˆ—ï¼Œä¹Ÿå°±æ˜¯æ‰¾ç‰¹å¼‚æ€§ä¸‹è°ƒé€šè·¯
}
# è¾“å‡ºæ¯ä¸€æ¬¡GSEAç»“æœ
write.table(GSEA.dat,paste0(subtype.label[[i]],"_degs_",mode,"_gsea.txt"),sep = "\t",row.names = T,col.names = NA,quote = F)
# äºšå‹ç‰¹å¼‚æ€§topåŸºå› é›†ä¿å­˜å…¥åˆ—è¡¨
top.gs[[subtype.label[i]]] <- rownames(GSEA.dat)[1:n.top]
}
# æ„å»ºGSVAåˆ†æéœ€è¦çš„gene list
gs <- list()
for (i in as.character(unlist(top.gs))) {
gs[[i]] <- MSigDB[which(MSigDB$ont %in% i),"gene"]
}
return(list(mode=mode,top.gs=top.gs,gs=gs))
}
msigdfFile = "h.all.v7.1.symbols.gmt"
n.top = 10
mode = "up" #"up"å’?dn"äºŒé€‰ä¸€
gs.up <- subtype_specific_gsea(msigdb = msigdfFile,
n.top = n.top,
degs.list = degs.list,
subtype.label = n.sub.label,
mode = mode)
# è®¡ç®—GSVAå¾—åˆ†
gsva_gs.up <- gsva(as.matrix(expr), gs.up$gs, method="gsva")
msigdfFile = "c5.all.v7.5.1.symbols.gmt"
n.top = 10
mode = "up" #"up"å’?dn"äºŒé€‰ä¸€
gs.up <- subtype_specific_gsea(msigdb = msigdfFile,
n.top = n.top,
degs.list = degs.list,
subtype.label = n.sub.label,
mode = mode)
# è®¡ç®—GSVAå¾—åˆ†
gsva_gs.up <- gsva(as.matrix(expr), gs.up$gs, method="gsva")
View(gs.up)
gs.up[["gs"]][["GOBP_EMBRYONIC_APPENDAGE_MORPHOGENESIS"]]
View(treat_list)
View(degs.list)
degs.list[["MITF-low"]]
View(degs.list)
View(gs.up)
gs.up[["gs"]][["GOCC_CORNIFIED_ENVELOPE"]]
gs.up[["top.gs"]]
gsva_gs.up <- gsva(as.matrix(expr), gs.up$gs, method="ssGSEA")
msigdfFile = "c5.all.v7.5.1.symbols.gmt"
n.top = 10
mode = "up" #"up"å’?dn"äºŒé€‰ä¸€
gs.up <- subtype_specific_gsea(msigdb = msigdfFile,
n.top = n.top,
degs.list = degs.list,
subtype.label = n.sub.label,
mode = mode)
# è®¡ç®—GSVAå¾—åˆ†
gsva_gs.up <- gsva(as.matrix(expr), gs.up$gs, method="ssgsea")
knitr::opts_chunk$set(echo = TRUE)
#install.packages("RIdeogram")
library(RIdeogram)
Sys.setenv(LANGUAGE = "en") #æ˜¾ç¤ºè‹±æ–‡æŠ¥é”™ä¿¡æ¯
options(stringsAsFactors = FALSE) #ç¦æ­¢chrè½¬æˆfactor
# æŸ“è‰²ä½“é•¿åº¦ã€ä¸­å¿ƒç²’ä½ç½®
karyotype <- read.csv("karyotype.csv")
karyotype
# æŸ“è‰²ä½“ä¸Šçš„heatmap
gene_density <- read.csv("easy_input_heatmap.csv")
head(gene_density)
# æŸ“è‰²ä½“æ—è¾¹çš„å½¢çŠ¶æ ‡è®°
Random_RNAs_500 <- read.csv("easy_input_mark.csv")
head(Random_RNAs_500)
ideogram(karyotype = karyotype,
#å¦‚æœæ²¡æä¾›easy_input_heatmap.csvï¼Œå°±åœ¨ä¸‹é¢ä¸¤è¡Œå‰é¢åŠ #
overlaid = gene_density,
#æŸ“è‰²ä½“ä¸Šheatmapçš„é…è‰?colorset1 = c("forestgreen", "gold", "deeppink3"),
#å¦‚æœæ²¡æä¾›easy_input_mark.csvï¼Œå°±åœ¨ä¸‹é¢è¿™è¡Œå‰é¢åŠ #
label = Random_RNAs_500,
#æŸ“è‰²ä½“å®½åº¦ï¼Œé»˜è®¤170
width = 200,
#å›¾ä¾‹çš„ä½ç½?Lx = 160, #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿå·¦è¾¹çš„è·ç¦?Ly = 20) #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿé¡¶ç«¯çš„è·ç¦?ideogram(karyotype = karyotype,
#å¦‚æœæ²¡æä¾›easy_input_heatmap.csvï¼Œå°±åœ¨ä¸‹é¢ä¸¤è¡Œå‰é¢åŠ #
overlaid = gene_density,
#æŸ“è‰²ä½“ä¸Šheatmapçš„é…è‰?colorset1 = c("forestgreen", "gold", "deeppink3"),
#å¦‚æœæ²¡æä¾›easy_input_mark.csvï¼Œå°±åœ¨ä¸‹é¢è¿™è¡Œå‰é¢åŠ #
# label = Random_RNAs_500,
#æŸ“è‰²ä½“å®½åº¦ï¼Œé»˜è®¤170
width = 200,
#å›¾ä¾‹çš„ä½ç½?Lx = 160, #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿå·¦è¾¹çš„è·ç¦?Ly = 20) #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿé¡¶ç«¯çš„è·ç¦?#svg2pdfæˆ–svg2tiffã€svg2jpgã€svg2png
svg2pdf("chromosome.svg",
width = 12, height = 8, #ç”»å¸ƒå¤§å°
dpi = 300)
# æŸ“è‰²ä½“é•¿åº¦ã€ä¸­å¿ƒç²’ä½ç½®
karyotype <- read.csv("karyotype.csv")
karyotype
# æŸ“è‰²ä½“ä¸Šçš„heatmap
gene_density <- read.csv("easy_input_heatmap.csv")
head(gene_density)
# æŸ“è‰²ä½“æ—è¾¹çš„å½¢çŠ¶æ ‡è®°
Random_RNAs_500 <- read.csv("easy_input_mark.csv")
head(Random_RNAs_500)
# æŸ“è‰²ä½“é•¿åº¦ã€ä¸­å¿ƒç²’ä½ç½®
karyotype <- read.csv("karyotype.csv")
karyotype
# æŸ“è‰²ä½“ä¸Šçš„heatmap
gene_density <- read.csv("easy_input_heatmap.csv")
head(gene_density)
# æŸ“è‰²ä½“æ—è¾¹çš„å½¢çŠ¶æ ‡è®°
#Random_RNAs_500 <- read.csv("easy_input_mark.csv")
#head(Random_RNAs_500)
ideogram(karyotype = karyotype,
#å¦‚æœæ²¡æä¾›easy_input_heatmap.csvï¼Œå°±åœ¨ä¸‹é¢ä¸¤è¡Œå‰é¢åŠ #
overlaid = gene_density,
#æŸ“è‰²ä½“ä¸Šheatmapçš„é…è‰?colorset1 = c("forestgreen", "gold", "deeppink3"),
#å¦‚æœæ²¡æä¾›easy_input_mark.csvï¼Œå°±åœ¨ä¸‹é¢è¿™è¡Œå‰é¢åŠ #
# label = Random_RNAs_500,
#æŸ“è‰²ä½“å®½åº¦ï¼Œé»˜è®¤170
width = 200,
#å›¾ä¾‹çš„ä½ç½?Lx = 160, #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿå·¦è¾¹çš„è·ç¦?Ly = 20) #å›¾ä¾‹å·¦ä¸Šè§’è·Ÿé¡¶ç«¯çš„è·ç¦?#svg2pdfæˆ–svg2tiffã€svg2jpgã€svg2png
svg2pdf("chromosome.svg",
width = 12, height = 8, #ç”»å¸ƒå¤§å°
dpi = 300)
install.packages("roxygen2")
q()
create_package("C:\\Users\\98706\\Desktop\\rpackage\\immcluster")
library(devtools)
library(roxygen2)
create_package("C:\\Users\\98706\\Desktop\\rpackage\\immcluster")
roxygenize("C:\\Users\\98706\\Desktop\\rpackage\\immcluster")
load("C:/Users/98706/Desktop/blca mRNA vaccine/32.batch/predictcluster.RData")
library(immcluster)
predictcluster(test)
library("immcluster")
?predictcluster()
knnImputation()
library(DMwR)
INSTALL.PACKAGES("DMwR2")
install.packages("DMwR2")
library("immcluster")
?predictcluster()
library(immcluster)
?predictcluster()
setwd("C:/Users/98706/Desktop/rpackage/HPXCS")
library(usethis)
library(devtools)
library(roxygen2)
setwd("C:/Users/98706/Desktop/rpackage")
usethis::create_package("./hpxcs")
library(usethis)
library(devtools)
library(roxygen2)
usethis::create_package("./HXPCS")
roxygenize("./HXPCS")
devtools::load_all()
setwd(./HPXCS)
setwd("./HPXCS")
library(usethis)
library(devtools)
library(roxygen2)
setwd("./HPXCS")
build()
